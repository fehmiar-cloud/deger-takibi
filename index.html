<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Finans Dashboard v4</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{font-family:-apple-system,Arial;background:#f3f4f6;margin:20px}
.section{background:#fff;padding:20px;border-radius:14px;margin-bottom:25px}
.kpi-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:15px}
.kpi{padding:15px;border-radius:12px;background:#fafafa}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border-bottom:1px solid #ddd;padding:6px;font-size:14px}
button{padding:6px 10px;margin:4px;cursor:pointer}
input,select{padding:5px}
.action{cursor:pointer;font-weight:bold}
.delete{color:red}
.edit{color:#2563eb}
</style>
</head>

<body>

<h1>ðŸ“Š Finans Dashboard</h1>

<div class="kpi-grid">
  <div class="kpi"><b>Son DeÄŸer</b><div id="kpiValue">-</div></div>
  <div class="kpi"><b>GÃ¼nlÃ¼k %</b><div id="kpiDaily">-</div></div>
  <div class="kpi"><b>Toplam Harcama</b><div id="kpiExpense">-</div></div>
  <div class="kpi"><b>7 GÃ¼n %</b><div id="kpiWeekly">-</div></div>
</div>

<div class="section">
<h3>ðŸ“¥ GÃ¼nlÃ¼k DeÄŸer</h3>
<input type="date" id="valueDate">
<input type="number" id="dailyValue">
<button onclick="addValue()">Ekle</button>
<button onclick="exportValues()">Excel</button>
<table id="valueTable"></table>
</div>

<div class="section">
<h3>ðŸ’¸ Harcama</h3>
<input type="date" id="expenseDate">
<input type="number" id="expenseAmount">
<select id="expenseCategory">
<option>Genel</option><option>Yemek</option><option>UlaÅŸÄ±m</option>
<option>Ofis</option><option>DiÄŸer</option>
</select>
<button onclick="addExpense()">Ekle</button>
<button onclick="exportExpenses()">Excel</button>
<table id="expenseTable"></table>
</div>

<div class="section"><canvas id="valueChart"></canvas></div>
<div class="section"><canvas id="expenseChart"></canvas></div>

<script>
let values=JSON.parse(localStorage.getItem("values"))||[];
let expenses=JSON.parse(localStorage.getItem("expenses"))||[];

function save(){localStorage.setItem("values",JSON.stringify(values));
localStorage.setItem("expenses",JSON.stringify(expenses));updateAll();}

function addValue(){values.push({date:valueDate.value,value:+dailyValue.value});save();}
function addExpense(){expenses.push({date:expenseDate.value,amount:+expenseAmount.value,cat:expenseCategory.value});save();}

function editValue(i){let v=prompt("Yeni deÄŸer",values[i].value);if(v){values[i].value=+v;save();}}
function editExpense(i){let v=prompt("Yeni tutar",expenses[i].amount);if(v){expenses[i].amount=+v;save();}}

function delValue(i){if(confirm("Silinsin mi?")){values.splice(i,1);save();}}
function delExpense(i){if(confirm("Silinsin mi?")){expenses.splice(i,1);save();}}

function exportCSV(data,name){
let csv=Object.keys(data[0]).join(",")+"\n"+data.map(o=>Object.values(o).join(",")).join("\n");
let a=document.createElement("a");
a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
a.download=name+".csv";a.click();
}

const exportValues=()=>values.length&&exportCSV(values,"gunluk_degerler");
const exportExpenses=()=>expenses.length&&exportCSV(expenses,"harcamalar");

let vc,ec;
function charts(){
if(vc)vc.destroy();
vc=new Chart(valueChart,{type:"line",
data:{labels:values.map(v=>v.date),datasets:[{data:values.map(v=>v.value),fill:true}]}});
let g={};expenses.forEach(e=>g[e.cat]=(g[e.cat]||0)+e.amount);
if(ec)ec.destroy();
ec=new Chart(expenseChart,{type:"pie",
data:{labels:Object.keys(g),datasets:[{data:Object.values(g)}]}});
}

function tables(){
valueTable.innerHTML="<tr><th>Tarih</th><th>DeÄŸer</th><th></th></tr>"+
values.map((v,i)=>`<tr><td>${v.date}</td><td>${v.value}</td>
<td><span class="action edit" onclick="editValue(${i})">âœŽ</span>
<span class="action delete" onclick="delValue(${i})"> âœ–</span></td></tr>`).join("");

expenseTable.innerHTML="<tr><th>Tarih</th><th>Tutar</th><th>Kategori</th><th></th></tr>"+
expenses.map((e,i)=>`<tr><td>${e.date}</td><td>${e.amount}</td><td>${e.cat}</td>
<td><span class="action edit" onclick="editExpense(${i})">âœŽ</span>
<span class="action delete" onclick="delExpense(${i})"> âœ–</span></td></tr>`).join("");
}

function kpi(){
if(values.length<2)return;
let l=values.at(-1),p=values.at(-2);
kpiValue.innerText=l.value;
kpiDaily.innerText=(((l.value-p.value)/p.value)*100).toFixed(2)+"%";
kpiExpense.innerText=expenses.reduce((a,b)=>a+b.amount,0);
}

function updateAll(){tables();charts();kpi();}
updateAll();
</script>
</body>
</html>
