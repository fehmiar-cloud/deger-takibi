<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DeÄŸer Takip Dashboard â€“ FINAL</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body{font-family:Arial;background:#f4f6f8;margin:0;padding:20px}
    h1{margin-bottom:10px;text-align:center;color:#2c3e50;font-size:28px;font-weight:bold}
    .card{background:#fff;border-radius:8px;padding:20px;margin-bottom:15px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
    .row{display:flex;gap:15px;flex-wrap:wrap}
    .kpi{flex:1;min-width:200px;font-size:14px;padding:10px;background:#ecf0f1;border-radius:8px;text-align:center}
    .kpi span{font-weight:bold}
    .green{color:#2ecc71;font-weight:bold}
    .red{color:#e74c3c;font-weight:bold}
    input,button{padding:8px;margin:5px 0;border-radius:4px}
    button{cursor:pointer;background:#3498db;color:#fff;border:none;}
    button:hover{background:#2980b9}
    table{width:100%;border-collapse:collapse;font-size:13px}
    th,td{border-bottom:1px solid #ddd;padding:6px;text-align:left}
    .scroll{max-height:220px;overflow-y:auto}
    select{padding:6px;border-radius:4px}
    .kpi-header{font-size:20px;color:#34495e;font-weight:bold;margin-bottom:10px;}
    .kpi-section{background-color:#ecf0f1;padding:20px;border-radius:8px;margin-top:20px;}
    .arrow-up::before{content:"â†‘";color:#2ecc71;}
    .arrow-down::before{content:"â†“";color:#e74c3c;}
  </style>
</head>
<body>

<h1>ğŸ“Š DeÄŸer Takip Dashboard</h1>

<!-- Ã–zet Dashboard ve Tarih SeÃ§enekleri -->
<div class="card">
  <div class="kpi-section">
    <h3 class="kpi-header">Ã–zet Dashboard</h3>
    <div class="row">
      <div class="kpi">
        <span>Mevcut DeÄŸer:</span>
        <p id="generalValue">-</p>
      </div>
      <div class="kpi">
        <span>Kar (TL):</span>
        <p id="kpiDiff">-</p>
      </div>
      <div class="kpi">
        <span>DeÄŸiÅŸim (%) :</span>
        <p id="kpiPct">-</p>
      </div>
    </div>
    <div class="row">
      <select id="presetRange" onchange="calculateTopRange()">
        <option value="7">Son 7 GÃ¼n</option>
        <option value="30">Son 30 GÃ¼n</option>
        <option value="365">Son 1 YÄ±l</option>
        <option value="custom">Ã–zel</option>
      </select>
      <input type="date" id="topStart" placeholder="BaÅŸlangÄ±Ã§ Tarihi">
      <input type="date" id="topEnd" placeholder="BitiÅŸ Tarihi">
    </div>
    <button onclick="calculateTopRange()">Hesapla</button>
  </div>
</div>

<!-- GÃ¼nlÃ¼k DeÄŸer Ekleme -->
<div class="card">
  <h3>GÃ¼nlÃ¼k DeÄŸer Ekle</h3>
  <input type="date" id="vDate">
  <input type="number" id="vAmount" placeholder="Toplam DeÄŸer">
  <button onclick="addValue()">Ekle</button>
  <br><br>
  <b>Import / Export (DeÄŸer)</b><br>
  <button onclick="exportValues()">â¬‡ï¸ Export</button>
  <input type="file" accept=".csv" onchange="importValues(event)">
</div>

<!-- Nakit Ã‡Ä±kÄ±ÅŸÄ± Ekleme -->
<div class="card">
  <h3>Nakit Ã‡Ä±kÄ±ÅŸÄ±</h3>
  <input type="date" id="cDate">
  <input type="number" id="cAmount" placeholder="Tutar">
  <input type="text" id="cNote" placeholder="AÃ§Ä±klama">
  <button onclick="addCash()">Ekle</button>
  <br><br>
  <b>Import / Export (Nakit)</b><br>
  <button onclick="exportCash()">â¬‡ï¸ Export</button>
  <input type="file" accept=".csv" onchange="importCash(event)">
</div>

<!-- KPI ve DeÄŸer Analizi -->
<div class="card row">
  <div class="kpi" id="kpi7"></div>
  <div class="kpi" id="kpi30"></div>
  <div class="kpi" id="kpi365"></div>
</div>

<!-- Tarih AralÄ±ÄŸÄ± Analizi -->
<div class="card">
  <h3>Tarih AralÄ±ÄŸÄ± Analizi</h3>
  <input type="date" id="rStart">
  <input type="date" id="rEnd">
  <button onclick="analyze()">Hesapla</button>
  <div id="rResult"></div>
  <div id="rCash"></div>
</div>

<!-- Grafik GÃ¶rÃ¼ntÃ¼leme -->
<div class="card"><canvas id="chart"></canvas></div>

<!-- GÃ¼nlÃ¼k DeÄŸerler Tablosu -->
<div class="card">
  <h3>GÃ¼nlÃ¼k DeÄŸerler</h3>
  <div class="scroll"><table id="vTable"></table></div>
</div>

<!-- Nakit Ã‡Ä±kÄ±ÅŸlarÄ± Tablosu -->
<div class="card">
  <h3>Nakit Ã‡Ä±kÄ±ÅŸlarÄ±</h3>
  <div class="scroll"><table id="cTable"></table></div>
</div>

<script>
let values=JSON.parse(localStorage.getItem('values')||'[]');
let cashes=JSON.parse(localStorage.getItem('cashes')||'[]');
let chart;

function save(){
  localStorage.setItem('values',JSON.stringify(values));
  localStorage.setItem('cashes',JSON.stringify(cashes));
}

function addValue(){
  values.push({date:vDate.value,amount:+vAmount.value});
  save();
  render();
}

function addCash(){
  cashes.push({date:cDate.value,amount:+cAmount.value,note:cNote.value});
  save();
  render();
}

function rangeCalc(s,e){
  let a=values.filter(x=>x.date>=s&&x.date<=e).sort((a,b)=>a.date.localeCompare(b.date));
  if(a.length<2) return null;
  let d=a[a.length-1].amount-a[0].amount;
  return{d,p:d/a[0].amount*100}
}

function cashSum(s,e){
  return cashes.filter(c=>c.date>=s&&c.date<=e).reduce((t,c)=>t+c.amount,0)
}

function analyze(){
  let r=rangeCalc(rStart.value,rEnd.value);
  if(!r) return;
  rResult.innerHTML=`<span class="${r.d>=0?'green':'red'}">${fmt(r.d)} TL (${r.p.toFixed(2)}%)</span>`;
  rCash.innerHTML=`Toplam Nakit Ã‡Ä±kÄ±ÅŸÄ±: ${fmt(cashSum(rStart.value,rEnd.value))} TL`
}

function render(){
  values.sort((a,b)=>a.date.localeCompare(b.date));
  vTable.innerHTML='<tr><th>Tarih</th><th>DeÄŸer</th></tr>'+values.map(v=>`<tr><td>${v.date}</td><td>${fmt(v.amount)}</td></tr>`).join('');
  cTable.innerHTML='<tr><th>Tarih</th><th>Tutar</th><th>AÃ§Ä±klama</th></tr>'+cashes.map(c=>`<tr><td>${c.date}</td><td>${fmt(c.amount)}</td><td>${c.note}</td></tr>`).join('');
  drawChart();
  calcKPI();
}

function calcKPI(){
  if(values.length<2) return;
  setK(7,'kpi7');
  setK(30,'kpi30');
  setK(365,'kpi365')
}

function setK(d,id){
  let e=values[values.length-1].date;
  let s=new Date(e);
  s.setDate(s.getDate()-d);
  s=s.toISOString().slice(0,10);
  let r=rangeCalc(s,e);
  let arrowClass = r.d >= 0 ? 'arrow-up' : 'arrow-down';
  document.getElementById(id).innerHTML=r?`${d} GÃ¼n: <span class="${r.d>=0?'green':'red'}">${fmt(r.d)} TL (${r.p.toFixed(2)}%) <span class="${arrowClass}"></span></span>`:`${d} GÃ¼n: -`
}

function drawChart(){
  let ctx=document.getElementById('chart');
  if(chart) chart.destroy();
  chart=new Chart(ctx,{type:'line',data:{labels:values.map(v=>v.date),datasets:[{label:'DeÄŸer',data:values.map(v=>v.amount),borderColor:'#3498db',fill:false}]}})
}

function exportValues(){
  let rows=['date,amount'];
  values.forEach(v=>rows.push(`${v.date},${v.amount}`));
  download(rows.join('\n'),'values.csv');
}

function exportCash(){
  let rows=['date,amount,note'];
  cashes.forEach(c=>rows.push(`${c.date},${c.amount},${c.note}`));
  download(rows.join('\n'),'cash.csv');
}

function download(text,name){
  let b=new Blob([text],{type:'text/csv'});
  let a=document.createElement('a');
  a.href=URL.createObjectURL(b);
  a.download=name;
  a.click();
}

function importValues(e){
  let r=new FileReader();
  r.onload=()=>{
    r.result.split('\n').slice(1).forEach(l=>{
      let[d,a]=l.split(',');
      if(d&&a) values.push({date:d,amount:+a});
    });
    save();
    render();
  };
  r.readAsText(e.target.files[0]);
}

function importCash(e){
  let r=new FileReader();
  r.onload=()=>{
    r.result.split('\n').slice(1).forEach(l=>{
      let[d,a,n]=l.split(',');
      if(d&&a) cashes.push({date:d,amount:+a,note:n});
    });
    save();
    render();
  };
  r.readAsText(e.target.files[0]);
}

function fmt(n){ return Number(n).toLocaleString('tr-TR'); }

function calculateTopRange(){
  let preset = document.getElementById('presetRange').value;
  let end = new Date();
  let start;
  if(preset !== 'custom'){
    start = new Date();
    start.setDate(end.getDate()-Number(preset));
  } else {
    start = new Date(document.getElementById('topStart').value);
    end = new Date(document.getElementById('topEnd').value);
  }
  let res = rangeCalc(start.toISOString().slice(0,10), end.toISOString().slice(0,10));
  if(!res) return;
  document.getElementById('generalValue').innerText = fmt(res.d);
  document.getElementById('kpiDiff').innerText = fmt(res.d);
  document.getElementById('kpiPct').innerText = res.p.toFixed(2) + '%';
}

render();
</script>

</body>
</html>
