<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>DeÄŸer Takibi Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, Arial;
    background: #f2f4f8;
    margin: 20px;
}
h1 { margin-bottom: 10px; }

.kpi-container {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(180px,1fr));
    gap: 15px;
    margin-bottom: 25px;
}
.kpi {
    background: white;
    padding: 15px;
    border-radius: 10px;
}
.kpi h3 {
    font-size: 14px;
    color: #666;
}
.kpi p {
    font-size: 20px;
    font-weight: bold;
}

.section {
    background: white;
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 25px;
}

input, button {
    padding: 6px;
    margin: 4px 0;
}
button {
    cursor: pointer;
}

canvas {
    margin-top: 20px;
}
</style>
</head>

<body>

<h1>ðŸ“Š DeÄŸer Takibi Dashboard</h1>

<!-- KPI -->
<div class="kpi-container">
    <div class="kpi"><h3>Son DeÄŸer</h3><p id="kpiValue">-</p></div>
    <div class="kpi"><h3>GÃ¼nlÃ¼k DeÄŸiÅŸim</h3><p id="kpiDaily">-</p></div>
    <div class="kpi"><h3>Toplam Harcama</h3><p id="kpiExpense">-</p></div>
    <div class="kpi"><h3>Son 7 GÃ¼n %</h3><p id="kpiWeekly">-</p></div>
</div>

<!-- GÄ°RÄ°ÅžLER -->
<div class="section">
<h3>GÃ¼nlÃ¼k DeÄŸer</h3>
<input type="date" id="valueDate">
<input type="number" id="dailyValue" placeholder="Toplam DeÄŸer">
<button onclick="addValue()">Kaydet</button>

<h3>Harcama</h3>
<input type="date" id="expenseDate">
<input type="number" id="expenseAmount" placeholder="Tutar">
<input type="text" id="expenseNote" placeholder="AÃ§Ä±klama">
<button onclick="addExpense()">Ekle</button>
</div>

<!-- GRAFÄ°KLER -->
<div class="section">
<h3>DeÄŸer Zaman GrafiÄŸi</h3>
<canvas id="valueChart"></canvas>
</div>

<div class="section">
<h3>Harcama DaÄŸÄ±lÄ±mÄ±</h3>
<canvas id="expenseChart"></canvas>
</div>

<script>
let values = JSON.parse(localStorage.getItem("values")) || [];
let expenses = JSON.parse(localStorage.getItem("expenses")) || [];

function save() {
    localStorage.setItem("values", JSON.stringify(values));
    localStorage.setItem("expenses", JSON.stringify(expenses));
    updateAll();
}

function addValue() {
    values.push({ date: valueDate.value, value: Number(dailyValue.value) });
    values.sort((a,b)=>a.date.localeCompare(b.date));
    save();
}

function addExpense() {
    expenses.push({
        date: expenseDate.value,
        amount: Number(expenseAmount.value),
        note: expenseNote.value || "DiÄŸer"
    });
    save();
}

function updateKPIs() {
    if (values.length < 2) return;

    const last = values.at(-1);
    const prev = values.at(-2);

    document.getElementById("kpiValue").innerText = last.value.toLocaleString() + " TL";
    document.getElementById("kpiDaily").innerText =
        (((last.value - prev.value) / prev.value) * 100).toFixed(2) + "%";

    document.getElementById("kpiExpense").innerText =
        expenses.reduce((a,b)=>a+b.amount,0).toLocaleString() + " TL";

    const weekAgo = values.find(v => v.date >= new Date(Date.now()-7*86400000).toISOString().slice(0,10));
    if (weekAgo) {
        document.getElementById("kpiWeekly").innerText =
            (((last.value - weekAgo.value) / weekAgo.value) * 100).toFixed(2) + "%";
    }
}

let valueChart, expenseChart;

function updateCharts() {
    const ctx = document.getElementById("valueChart");

    if (valueChart) valueChart.destroy();

    valueChart = new Chart(ctx, {
        type: "line",
        data: {
            labels: values.map(v=>v.date),
            datasets: [{
                label: "Toplam DeÄŸer",
                data: values.map(v=>v.value),
                fill: true,
                borderColor: "#4f46e5",
                backgroundColor: "rgba(79,70,229,0.15)",
                tension: 0.3
            }]
        }
    });

    const grouped = {};
    expenses.forEach(e => grouped[e.note] = (grouped[e.note] || 0) + e.amount);

    const ctx2 = document.getElementById("expenseChart");
    if (expenseChart) expenseChart.destroy();

    expenseChart = new Chart(ctx2, {
        type: "pie",
        data: {
            labels: Object.keys(grouped),
            datasets: [{
                data: Object.values(grouped),
                backgroundColor: ["#6366f1","#22c55e","#f97316","#ef4444","#0ea5e9"]
            }]
        }
    });
}

function updateAll() {
    updateKPIs();
    updateCharts();
}

updateAll();
</script>

</body>
</html>
