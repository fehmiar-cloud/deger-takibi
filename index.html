<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DeÄŸer Takip Dashboard â€“ FINAL</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{font-family:Arial;background:#f4f6f8;margin:0;padding:20px}
h1{margin-bottom:10px}
.card{background:#fff;border-radius:8px;padding:15px;margin-bottom:15px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
.row{display:flex;gap:15px;flex-wrap:wrap}
.kpi{flex:1;min-width:200px;font-size:14px}
.green{color:#2ecc71;font-weight:bold}
.red{color:#e74c3c;font-weight:bold}
input,button{padding:6px;margin:4px 0}
button{cursor:pointer}
table{width:100%;border-collapse:collapse;font-size:13px}
th,td{border-bottom:1px solid #ddd;padding:6px;text-align:left}
.scroll{max-height:220px;overflow-y:auto}
</style>
</head>
<body>

<h1>ğŸ“Š DeÄŸer Takip Dashboard</h1>

<div class="card">
<h3>GÃ¼nlÃ¼k DeÄŸer Ekle</h3>
<input type="date" id="vDate">
<input type="number" id="vAmount" placeholder="Toplam DeÄŸer">
<button onclick="addValue()">Ekle</button>
</div>

<div class="card">
<h3>Nakit Ã‡Ä±kÄ±ÅŸÄ±</h3>
<input type="date" id="cDate">
<input type="number" id="cAmount" placeholder="Tutar">
<input type="text" id="cNote" placeholder="AÃ§Ä±klama">
<button onclick="addCash()">Ekle</button>
</div>

<div class="card row">
<div class="kpi" id="kpi7"></div>
<div class="kpi" id="kpi30"></div>
<div class="kpi" id="kpi365"></div>
</div>

<div class="card">
<h3>Tarih AralÄ±ÄŸÄ± Analizi</h3>
<input type="date" id="rStart">
<input type="date" id="rEnd">
<button onclick="analyze()">Hesapla</button>
<div id="rResult"></div>
<div id="rCash"></div>
</div>

<div class="card"><canvas id="chart"></canvas></div>

<div class="card">
<h3>GÃ¼nlÃ¼k DeÄŸerler</h3>
<div class="scroll"><table id="vTable"></table></div>
</div>

<div class="card">
<h3>Nakit Ã‡Ä±kÄ±ÅŸlarÄ±</h3>
<div class="scroll"><table id="cTable"></table></div>
</div>

<div class="card">
<h3>Import / Export</h3>
<button onclick="exportCSV()">â¬‡ï¸ Export CSV</button><br>
<input type="file" id="fileInput" accept=".csv" onchange="importCSV(event)">
</div>

<script>
let values=JSON.parse(localStorage.getItem('values')||'[]');
let cashes=JSON.parse(localStorage.getItem('cashes')||'[]');
let chart;

function save(){
localStorage.setItem('values',JSON.stringify(values));
localStorage.setItem('cashes',JSON.stringify(cashes));
}

function addValue(){values.push({date:vDate.value,amount:+vAmount.value});save();render()}
function addCash(){cashes.push({date:cDate.value,amount:+cAmount.value,note:cNote.value});save();render()}

function rangeCalc(s,e){let a=values.filter(x=>x.date>=s&&x.date<=e).sort((a,b)=>a.date.localeCompare(b.date));if(a.length<2)return null;let d=a[a.length-1].amount-a[0].amount;return{d,p:d/a[0].amount*100}}
function cashSum(s,e){return cashes.filter(c=>c.date>=s&&c.date<=e).reduce((t,c)=>t+c.amount,0)}

function analyze(){let r=rangeCalc(rStart.value,rEnd.value);if(!r)return;rResult.innerHTML=`<span class="${r.d>=0?'green':'red'}">${fmt(r.d)} TL (${r.p.toFixed(2)}%)</span>`;rCash.innerHTML=`Toplam Nakit Ã‡Ä±kÄ±ÅŸÄ±: ${fmt(cashSum(rStart.value,rEnd.value))} TL`}

function render(){
values.sort((a,b)=>a.date.localeCompare(b.date));
vTable.innerHTML='<tr><th>Tarih</th><th>DeÄŸer</th></tr>'+values.map(v=>`<tr><td>${v.date}</td><td>${fmt(v.amount)}</td></tr>`).join('');
cTable.innerHTML='<tr><th>Tarih</th><th>Tutar</th><th>AÃ§Ä±klama</th></tr>'+cashes.map(c=>`<tr><td>${c.date}</td><td>${fmt(c.amount)}</td><td>${c.note}</td></tr>`).join('');
drawChart();calcKPI();}

function calcKPI(){if(values.length<2)return;setK(7,'kpi7');setK(30,'kpi30');setK(365,'kpi365')}
function setK(d,id){let e=values[values.length-1].date;let s=new Date(e);s.setDate(s.getDate()-d);s=s.toISOString().slice(0,10);let r=rangeCalc(s,e);document.getElementById(id).innerHTML=r?`${d} GÃ¼n: <span class="${r.d>=0?'green':'red'}">${fmt(r.d)} TL (${r.p.toFixed(2)}%)</span>`:`${d} GÃ¼n: -`}

function drawChart(){let ctx=document.getElementById('chart');if(chart)chart.destroy();chart=new Chart(ctx,{type:'line',data:{labels:values.map(v=>v.date),datasets:[{label:'DeÄŸer',data:values.map(v=>v.amount),borderColor:'#3498db',fill:false}]}})}

function exportCSV(){let rows=['type,date,amount,note'];values.forEach(v=>rows.push(`value,${v.date},${v.amount},`));cashes.forEach(c=>rows.push(`cash,${c.date},${c.amount},${c.note}`));let b=new Blob([rows.join('\n')],{type:'text/csv'});let a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='dashboard-data.csv';a.click()}

function importCSV(e){let r=new FileReader();r.onload=()=>{values=[];cashes=[];r.result.split('\n').slice(1).forEach(l=>{let[t,d,a,n]=l.split(',');if(t==='value')values.push({date:d,amount:+a});if(t==='cash')cashes.push({date:d,amount:+a,note:n})});save();render()};r.readAsText(e.target.files[0])}

function fmt(n){return Number(n).toLocaleString('tr-TR')}
render();
</script>
</body>
</html>
